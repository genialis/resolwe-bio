# ===================================
# Import coverage (.cov; .covd) files
# ===================================
---

- slug: upload-coverage
  name: Coverage
  requirements:
    expression-engine: jinja
  data_name: '{{ src.file|default("?") }}'
  version: 0.0.1
  type: data:coverage:upload
  category: upload
  persistence: RAW
  description: >
    Upload bedtools coverage (coveragebed) result files.
  input:
    - name: cov
      label: Coverage
      type: basic:file
      description: >
        Bedtools coverage .cov file.
      validate_regex: '\.(cov)$'
    - name: covd
      label: Coverage (depth at each position)
      type: basic:file
      validate_regex: '\.(covd)$'
      description: >
        Bedtools coverage .covd file.
  output:
    - name: cov
      label: Coverage
      type: basic:file
    - name: covd
      label: Coverage (depth at each position)
      type: basic:file
  run:
    runtime: polyglot
    language: bash
    program: |
        re-import "{{ cov.file_temp }}" "{{ cov.file }}" "cov" "cov" 0.4 extract
        re-save-file cov "${NAME}.cov"

        re-import "{{ covd.file_temp }}" "{{ covd.file }}" "covd" "covd" 0.8 extract
        re-save-file covd "${NAME}.covd"
