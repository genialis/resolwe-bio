# ==========================
# Integration with tranSMART
# ==========================
#
# Processors for the integration of Genialis and tranSMART platforms.
---

- name: import:web:transmart:expressions
  version: 0.0.10
  label: Import Expressions from tranSMART
  type: "data:expressionset"
  category: import
  persistence: RAW
  description: >
    Import gene expressions and the corresponding annotations from tranSMART.
  input:
    - name: exps
      label: Gene expressions
      type: basic:string
      required: true
    - name: ann
      label: Sample annotations
      type: basic:string
      required: false
    - name: token
      label: Authorization token
      type: basic:string
      required: true
  output:
    - name: expset
      label: Expression set
      type: basic:file
    - name: expset_type
      label: Expression set type
      type: basic:string
  static:
    - name: name
      label: Name
      type: basic:string
      default: 'Import from tranSMART'
    - name: cite
      label: Citation
      type: list:basic:url:link
    - name: experiment
      label: Experiment
      type: basic:string
    - name: attachments
      label: Attachments
      type: list:basic:file
    - name: tags
      label: Tags
      type: list:basic:string
      default: ["expression"]
      placeholder: new tag
    - name: description
      label: Description
      type: basic:text
  var:
    - name: notes
      label: Notes
      type: basic:text
  run:
    runtime: polyglot
    bash: |
      re-require common

      transmart_fetch.R --expsConceptLinks {{exps}} --token {{token}} --out expression_data.tab
      re-checkrc "Error fetching expression data from tranSMART."

      re-progress 0.5

      {% if ann %}
        transmart_fetch.R --annConceptLinks {{ann}} --token {{token}} --out annotation_data.tab
        re-checkrc "Error fetching annotation data from tranSMART."
      {% endif %}

      re-save expset_type "Log2"

      transmart_import.py expression_data.tab {% if ann %}--annotation annotation_data.tab{% endif %} --progress 0.5
      re-checkrc "Import from tranSMART failed."
